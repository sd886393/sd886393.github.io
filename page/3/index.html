<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 3 页 | littleji</title>
  <meta name="author" content="littleji">
  
  <meta name="description" content="littleji&#39;s blog">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="littleji"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="littleji" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-77530561-1', 'auto');
	ga('send', 'pageview');

</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-127734909-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-127734909-1');
</script>


<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
  <h1><a href="/">littleji</a></h1>
  <h2><a href="/">a blog</a></h2>
  <h2><a href="https://github.com/littleji" title="GithubID:littleji" target="_blank"><i class="fa fa-3x fa-github"></i></a> &nbsp;</h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/booklist">Booklist</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json-rpc%E7%9A%84%E6%A0%87%E5%87%86%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E"><span class="toc-number">2.</span> <span class="toc-text">json-rpc的标准详细说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rpc%E8%AF%B7%E6%B1%82%E6%89%80%E5%BF%85%E8%A6%81%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">rpc请求所必要的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rpc%E5%93%8D%E5%BA%94%E6%89%80%E5%BF%85%E8%A6%81%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">rpc响应所必要的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%AF%B9%E8%B1%A1%E6%89%80%E5%BF%85%E8%A6%81%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">错误对象所必要的参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8curl%E6%9D%A5%E6%B5%8B%E8%AF%95%E5%B7%B2%E7%BB%8F%E5%BB%BA%E7%AB%8B%E7%9A%84json-rpc%E6%9C%8D%E5%8A%A1"><span class="toc-number">6.</span> <span class="toc-text">使用curl来测试已经建立的json-rpc服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%8D%95%E4%B8%AA%E8%AF%B7%E6%B1%82"><span class="toc-number">6.1.</span> <span class="toc-text">测试单个请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%89%B9%E7%9A%84%E6%96%B9%E5%BC%8F%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-number">6.2.</span> <span class="toc-text">测试批的方式发送请求</span></a></li></ol></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-12T11:50:20.000Z"><a href="/2016/12/12/20161212UseJsonRPCFormatToGetWhatYouWant/">2016-12-12</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/12/20161212UseJsonRPCFormatToGetWhatYouWant/">json-rpc的标准调用(UseJsonRPCFormatToGetWhatYouWant)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文承接上文的<a href="http://littleji.com/2016/12/06/QuickStartForJsonrpc4j/" target="_blank" rel="noopener">jsonrpc4j初步使用</a>,在知道了如何部署Server端以及通过Java的接口调用部署的服务后,下面就是通过json-rpc本身的标准来实际的调用rpc借口和处理返回的相关信息.</p>
<h2 id="json-rpc的标准详细说明"><a href="#json-rpc的标准详细说明" class="headerlink" title="json-rpc的标准详细说明"></a>json-rpc的标准详细说明</h2><p>这方面具体请参考:</p>
<ol>
<li><a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html" target="_blank" rel="noopener">中文</a></li>
<li><a href="http://www.json.org/" target="_blank" rel="noopener">English</a><br>这里拿出一些必要且简单的说明.</li>
</ol>
<h2 id="rpc请求所必要的参数"><a href="#rpc请求所必要的参数" class="headerlink" title="rpc请求所必要的参数"></a>rpc请求所必要的参数</h2><ol>
<li>请求的对象需要通过json的格式发往server端</li>
<li>请求对象需要包括下面四个对象<ol>
<li>jsonrpc:来说明所使用的JSON-RPC的版本</li>
<li>methode:来说明说调用的方法名称</li>
<li>params:调用方法的结构化参数值</li>
<li>id:来唯一的表明发起的请求,客户端同样通过这个id来唯一的表示响应的信息,这个id可以是字符串,数字和NULL.如果没有这个值则认为这个请求是一个通知</li>
</ol>
</li>
</ol>
<h2 id="rpc响应所必要的参数"><a href="#rpc响应所必要的参数" class="headerlink" title="rpc响应所必要的参数"></a>rpc响应所必要的参数</h2><ol>
<li>jsonrpc:同请求</li>
<li>result: 如果一个请求成功的调用了方法,则必须有这一项,否则不必有这一项</li>
<li>error:错误的对象.如果一个方法失败了,必须有该项,否则不必有</li>
<li>id:该成员必须有,同请求.</li>
</ol>
<h2 id="错误对象所必要的参数"><a href="#错误对象所必要的参数" class="headerlink" title="错误对象所必要的参数"></a>错误对象所必要的参数</h2><ol>
<li>code:使用整数来表明的异常错误类型,-32768到-32000为保留的错误代码,详细的错误代码所对应的解释请参考 <a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html" target="_blank" rel="noopener">中文</a></li>
<li>message:描述错误信息</li>
<li>data:包含错误复杂信息的成员,可忽略.</li>
</ol>
<h2 id="使用curl来测试已经建立的json-rpc服务"><a href="#使用curl来测试已经建立的json-rpc服务" class="headerlink" title="使用curl来测试已经建立的json-rpc服务"></a>使用curl来测试已经建立的json-rpc服务</h2><ul>
<li>需要按照前文,建立好对应的服务</li>
</ul>
<h3 id="测试单个请求"><a href="#测试单个请求" class="headerlink" title="测试单个请求"></a>测试单个请求</h3><p>通过使用curl来发送http的请求,当然也可以通过java的HttpClient来发送,假设RpcServer部署相应的服务,且url为<code>/rpc</code>,我们使用server端的”getString”方法,server端部署在192.168.1.10的8080端口上,那么代码如下<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST "http://192.168.1.10:8080/rpc" -d "{"jsonrpc":"2.0", "id":"10", "method":"getString", "params":["Test"]}"</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>可以看到服务端返回这样的信息<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{"jsonrpc":"jsonrpc","id":"null","error":{"code":-32700,"message":"JSON parse error"}}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>说明发送的信息不是一个合法的JSON串,检查后发现因为curl发送数据的问题,需要对引号进行转义,更改后的请求命令如下:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST "http://192.168.1.10:8080/rpc" -d "{\"jsonrpc\":\"2.0\", \"id\":\"10\", \"method\":\"getString\", \"params\":[\"Test\"]}"</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>服务端返回信息:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">{"jsonrpc":"2.0","id":"10","result":"{Test}"}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>信息正常的返回了,说明调用成功</p>
<h3 id="测试批的方式发送请求"><a href="#测试批的方式发送请求" class="headerlink" title="测试批的方式发送请求"></a>测试批的方式发送请求</h3><p>原理非常简单,只需要将发送的一组请求使用数组的形式括起来即可,代码如下:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST "http://192.168.101.188:8080/rpc" -d "[{\"jsonrpc\":\"2.0\", \"id\":\"1\", \"method\":\"getString\", \"params\":[\"Test\"]},{\"jsonrpc\":\"2.0\", \"id\":\"2\", \"method\":\"getString\", \"params\":[\"哈哈\"]}]"</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>服务端返回:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[{"jsonrpc":"2.0","id":"1","result":"{Test}"}</span><br><span class="line">,{"jsonrpc":"2.0","id":"2","result":"{哈哈}"}</span><br></pre></td></tr></tbody></table></figure><p></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/12/12/20161212UseJsonRPCFormatToGetWhatYouWant/">https://blog.littleji.com/2016/12/12/20161212UseJsonRPCFormatToGetWhatYouWant/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Maven"><span class="toc-number">2.</span> <span class="toc-text">Maven</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B5%8B%E8%AF%95%E7%94%A8%E7%9A%84model-service"><span class="toc-number">3.</span> <span class="toc-text">配置测试用的model,service</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#model"><span class="toc-number">3.1.</span> <span class="toc-text">model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service%E5%92%8C%E5%85%B6Implement"><span class="toc-number">3.2.</span> <span class="toc-text">Service和其Implement</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEserver%E7%AB%AF"><span class="toc-number">4.</span> <span class="toc-text">配置server端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet%E7%9A%84web-xml"><span class="toc-number">5.</span> <span class="toc-text">Servlet的web.xml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-number">6.</span> <span class="toc-text">测试类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Streaming-server-and-client"><span class="toc-number">7.</span> <span class="toc-text">Streaming server and client</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Without-the-Spring-Framework"><span class="toc-number">8.</span> <span class="toc-text">Without the Spring Framework</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%B5%8B%E8%AF%95%E7%9A%84%E8%A7%A3%E9%87%8A"><span class="toc-number">9.</span> <span class="toc-text">对测试的解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">10.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-06T11:50:20.000Z"><a href="/2016/12/06/20161206QuickStartForJsonrpc4j/">2016-12-06</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/06/20161206QuickStartForJsonrpc4j/">jsonrpc4j初步使用(Quick Start For Jsonrpc4j)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>目前有个项目需要向外提供服务:</p>
<ol>
<li>不打算用spring相对来说比较重的框架</li>
<li>后来考虑过jersey+jetty的restful框架,但是restful本身的应用场景,或者说是抽象较为局限,主要是编者水平有限</li>
<li>再之后又看了thrift的使用,稍微上手,认为操作还是较为繁杂.</li>
<li>json-rpc以前并没有接触过,json相对来说又有传输占用带宽较小等广为人知的优点,便以此篇为个契机学习一下.<br>jsonrpc4j是briandilley开发,项目的地址是<a href="https://github.com/briandilley/jsonrpc4j" target="_blank" rel="noopener">github</a><br>jsonrpc4j 服从json-rpc的规范,<a href="http://www.jsonrpc.org/" target="_blank" rel="noopener">规范链接在此</a><br>其主要支持下面这4类客户端:<br>Streaming server (InputStream \ OutputStream)<br>HTTP Server (HttpServletRequest \ HttpServletResponse)<br>Portlet Server (ResourceRequest \ ResourceResponse)<br>Socket Server (StreamServer)<br>这次主要使用的是HTTP Server</li>
</ol>
<h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><p>jsonrpc项目通过Maven构建,首先需要在pom.xm中加入对jsonrpc4j的依赖,如下面所示:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><!-- jsonrpc4j --></span><br><span class="line"><dependency></span><br><span class="line">    <groupId>com.github.briandilley.jsonrpc4j</groupId></span><br><span class="line">    <artifactId>jsonrpc4j</artifactId></span><br><span class="line">    <version>1.4.6</version></span><br><span class="line"></dependency></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>但是仅仅加入上面的依赖还不够,完整的pom.xml如下所示:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><?xml version="1.0" encoding="UTF-8"?></span><br><span class="line"><project xmlns="http://maven.apache.org/POM/4.0.0"</span><br><span class="line">         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br><span class="line">         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"></span><br><span class="line">    <modelVersion>4.0.0</modelVersion></span><br><span class="line"> </span><br><span class="line">    <groupId>com.littleji</groupId></span><br><span class="line">    <artifactId>jsonrpc-demo</artifactId></span><br><span class="line">    <version>1.0-SNAPSHOT</version></span><br><span class="line">    <dependencies></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>com.github.briandilley.jsonrpc4j</groupId></span><br><span class="line">            <artifactId>jsonrpc4j</artifactId></span><br><span class="line">            <version>1.4.6</version></span><br><span class="line">        </dependency></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>com.fasterxml.jackson.core</groupId></span><br><span class="line">            <artifactId>jackson-core</artifactId></span><br><span class="line">            <version>2.7.2</version></span><br><span class="line">        </dependency></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>com.fasterxml.jackson.core</groupId></span><br><span class="line">            <artifactId>jackson-databind</artifactId></span><br><span class="line">            <version>2.7.2</version></span><br><span class="line">        </dependency></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>com.fasterxml.jackson.core</groupId></span><br><span class="line">            <artifactId>jackson-annotations</artifactId></span><br><span class="line">            <version>2.7.2</version></span><br><span class="line">        </dependency></span><br><span class="line">        <!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>com.fasterxml.jackson.core</groupId></span><br><span class="line">            <artifactId>jackson-databind</artifactId></span><br><span class="line">            <version>2.7.2</version></span><br><span class="line">        </dependency></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>org.slf4j</groupId></span><br><span class="line">            <artifactId>slf4j-api</artifactId></span><br><span class="line">            <version>1.7.9</version></span><br><span class="line">        </dependency></span><br><span class="line"> </span><br><span class="line">        <!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>javax.servlet</groupId></span><br><span class="line">            <artifactId>javax.servlet-api</artifactId></span><br><span class="line">            <version>3.1.0</version></span><br><span class="line">        </dependency></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>org.apache.httpcomponents</groupId></span><br><span class="line">            <artifactId>httpcore-nio</artifactId></span><br><span class="line">            <version>4.4.4</version></span><br><span class="line">        </dependency></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>commons-codec</groupId></span><br><span class="line">            <artifactId>commons-codec</artifactId></span><br><span class="line">            <version>1.10</version></span><br><span class="line">        </dependency></span><br><span class="line">        <!-- https://mvnrepository.com/artifact/javax.portlet/portlet-api --></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>javax.portlet</groupId></span><br><span class="line">            <artifactId>portlet-api</artifactId></span><br><span class="line">            <version>2.0</version></span><br><span class="line">        </dependency></span><br><span class="line">        <dependency></span><br><span class="line">            <groupId>net.iharder</groupId></span><br><span class="line">            <artifactId>base64</artifactId></span><br><span class="line">            <version>2.3.9</version></span><br><span class="line">        </dependency></span><br><span class="line">    </dependencies></span><br><span class="line"> </span><br><span class="line"></project></span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="配置测试用的model-service"><a href="#配置测试用的model-service" class="headerlink" title="配置测试用的model,service"></a>配置测试用的model,service</h2><h3 id="model"><a href="#model" class="headerlink" title="model"></a>model</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.littleji.jsonrpc.demo;</span><br><span class="line"> </span><br><span class="line">import java.io.Serializable;</span><br><span class="line"> </span><br><span class="line">public class DemoBean implements Serializable{</span><br><span class="line">    private static final long serialVersionUID = -5141784935371524L;</span><br><span class="line">    private int code;</span><br><span class="line">    private String msg;</span><br><span class="line"> </span><br><span class="line">    public int getCode() {</span><br><span class="line">        return code;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    public void setCode(int code) {</span><br><span class="line">        this.code = code;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    public String getMsg() {</span><br><span class="line">        return msg;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    public void setMsg(String msg) {</span><br><span class="line">        this.msg = msg;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Service和其Implement"><a href="#Service和其Implement" class="headerlink" title="Service和其Implement"></a>Service和其Implement</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.littleji.jsonrpc.demo;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line">* Created by Jimmy on 2016/12/6.</span><br><span class="line">*/</span><br><span class="line">public interface DemoService {</span><br><span class="line">        public DemoBean getDemo(String code, String msg);</span><br><span class="line"> </span><br><span class="line">        public Integer getInt(Integer code);</span><br><span class="line"> </span><br><span class="line">        public String getString(String msg);</span><br><span class="line"> </span><br><span class="line">        public void doSomething();</span><br><span class="line"> </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class DemoServiceImply implements DemoService {</span><br><span class="line"> </span><br><span class="line">    public DemoBean getDemo(String code, String msg) {</span><br><span class="line">        DemoBean bean1 = new DemoBean();</span><br><span class="line">        bean1.setCode(Integer.parseInt(code));</span><br><span class="line">        bean1.setMsg(msg);</span><br><span class="line">        return bean1;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    public Integer getInt(Integer code) {</span><br><span class="line">        return code;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    public String getString(String msg) {</span><br><span class="line">        return "{"+msg+"}";</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    public void doSomething() {</span><br><span class="line">        System.out.println("do something");</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="配置server端"><a href="#配置server端" class="headerlink" title="配置server端"></a>配置server端</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">package com.littleji.jsonrpc.demo;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line">* Created by Jimmy on 2016/12/6.</span><br><span class="line">*/</span><br><span class="line">import java.io.IOException;</span><br><span class="line"> </span><br><span class="line">import javax.servlet.ServletConfig;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">import com.googlecode.jsonrpc4j.JsonRpcServer;</span><br><span class="line">import com.googlecode.jsonrpc4j.ProxyUtil;</span><br><span class="line"> </span><br><span class="line">public class RpcServer extends HttpServlet {</span><br><span class="line">    private static final long serialVersionUID = 12341234345L;</span><br><span class="line">    private JsonRpcServer rpcServer = null;</span><br><span class="line">    private DemoService demoService = null;</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    public void init(ServletConfig config) throws ServletException {</span><br><span class="line">        super.init(config);</span><br><span class="line">        demoService = new DemoServiceImply();</span><br><span class="line">        Object compositeService = ProxyUtil.createCompositeServiceProxy(</span><br><span class="line">                this.getClass().getClassLoader(),</span><br><span class="line">                new Object[] { demoService},</span><br><span class="line">                new Class<?>[] { DemoService.class},</span><br><span class="line">                true);</span><br><span class="line"> </span><br><span class="line">        rpcServer = new JsonRpcServer(compositeService);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    @Override</span><br><span class="line">    protected void service(HttpServletRequest request,</span><br><span class="line">                           HttpServletResponse response) throws ServletException, IOException {</span><br><span class="line">        rpcServer.handle(request, response);</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Servlet的web-xml"><a href="#Servlet的web-xml" class="headerlink" title="Servlet的web.xml"></a>Servlet的web.xml</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><!DOCTYPE web-app PUBLIC</span><br><span class="line">"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</span><br><span class="line">"http://java.sun.com/dtd/web-app_2_3.dtd" ></span><br><span class="line"> </span><br><span class="line"><web-app></span><br><span class="line">  <display-name>Archetype Created Web Application</display-name></span><br><span class="line">  <servlet></span><br><span class="line">      <servlet-name>RpcServer</servlet-name></span><br><span class="line">      <display-name>RpcServer</display-name></span><br><span class="line">      <description></description></span><br><span class="line">      <servlet-class>com.littleji.jsonrpc.demo.RpcServer</servlet-class></span><br><span class="line">  </servlet></span><br><span class="line">  <servlet-mapping></span><br><span class="line">      <servlet-name>RpcServer</servlet-name></span><br><span class="line">      <url-pattern>/rpc</url-pattern></span><br><span class="line">  </servlet-mapping></span><br><span class="line"></web-app></span><br></pre></td></tr></tbody></table></figure>
<h2 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">package com.littleji.jsonrpc.test;</span><br><span class="line"> </span><br><span class="line">import com.googlecode.jsonrpc4j.JsonRpcHttpClient;</span><br><span class="line">import com.googlecode.jsonrpc4j.ProxyUtil;</span><br><span class="line">import com.littleji.jsonrpc.demo.DemoService;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">import java.net.URL;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line">* Created by Jimmy on 2016/12/7.</span><br><span class="line">*/</span><br><span class="line">public class jsonrpctest2 {</span><br><span class="line">    public static void main(String [] args) throws Throwable {</span><br><span class="line">        try {</span><br><span class="line">            JsonRpcHttpClient client = new JsonRpcHttpClient(</span><br><span class="line">                    new URL("http://127.0.0.1:8080/rpc"));</span><br><span class="line"> </span><br><span class="line">            DemoService userService = ProxyUtil.createClientProxy(</span><br><span class="line">                    client.getClass().getClassLoader(),</span><br><span class="line">                    DemoService.class,</span><br><span class="line">                    client);</span><br><span class="line">             //两种调用方式</span><br><span class="line">            System.out.println(userService.getString("aa"));</span><br><span class="line">            System.out.println( client.invoke("getString", new String[] { "haha" }, String.class));</span><br><span class="line">            System.out.println( client.invoke("getInt", new Integer[] { 2 }, Integer.class));</span><br><span class="line"> </span><br><span class="line">        }</span><br><span class="line">        catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Streaming-server-and-client"><a href="#Streaming-server-and-client" class="headerlink" title="Streaming server and client"></a>Streaming server and client</h2><p>jsonrpc4j 主要是通过流服务器和客户端来处理应用(不仅仅是HTTP)的请求,而<code>JsonRpcClient</code>和<code>JsonRpcServer</code>有一些简单的方法来获得输入和输出流,且在库中附带着一个JsonRpcHttpClient,用来扩展JsonRpcClient对于HTTP的支持</p>
<h2 id="Without-the-Spring-Framework"><a href="#Without-the-Spring-Framework" class="headerlink" title="Without the Spring Framework"></a>Without the Spring Framework</h2><p>jsonrpc4j可以不使用spring框架,事实上二者均可运行于Android环境中</p>
<h2 id="对测试的解释"><a href="#对测试的解释" class="headerlink" title="对测试的解释"></a>对测试的解释</h2><p>其实测试类就是一个客户端的简单使用<br>下面是一个客户端使用JSON-RPC服务的例子,具体如下:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JsonRpcHttpClient client = new JsonRpcHttpClient(</span><br><span class="line">    new URL("http://example.com/UserService.json"));</span><br><span class="line"> </span><br><span class="line">User user = client.invoke("createUser", new Object[] { "bob", "the builder" }, User.class);</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>或者使用ProxyUtil类结合接口,来创建一个动态的代理,如下所示:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">JsonRpcHttpClient client = new JsonRpcHttpClient(</span><br><span class="line">    new URL("http://example.com/UserService.json"));</span><br><span class="line"> </span><br><span class="line">UserService userService = ProxyUtil.createClientProxy(</span><br><span class="line">    getClass().getClassLoader(),</span><br><span class="line">    UserService.class,</span><br><span class="line">    client);</span><br><span class="line"> </span><br><span class="line">User user = userService.createUser("bob", "the builder");</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/briandilley/jsonrpc4j" target="_blank" rel="noopener">jsonrpc4j</a><br><a href="http://blog.csdn.net/hjcenry/article/details/52440925" target="_blank" rel="noopener">JSON-RPC（jsonrpc4j）使用demo</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/12/06/20161206QuickStartForJsonrpc4j/">https://blog.littleji.com/2016/12/06/20161206QuickStartForJsonrpc4j/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E7%8B%AC%E6%96%87%E6%A1%A3%E7%9A%84APIs"><span class="toc-number">1.</span> <span class="toc-text">单独文档的APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Index-API"><span class="toc-number">1.1.</span> <span class="toc-text">Index API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90Json"><span class="toc-number">1.1.1.</span> <span class="toc-text">生成Json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3"><span class="toc-number">1.1.2.</span> <span class="toc-text">建立索引文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetAPI"><span class="toc-number">1.2.</span> <span class="toc-text">GetAPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BulkAPI"><span class="toc-number">1.3.</span> <span class="toc-text">BulkAPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Using-Bulk-Processor"><span class="toc-number">1.4.</span> <span class="toc-text">使用Using Bulk Processor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">2.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-01T02:40:20.000Z"><a href="/2016/12/01/20161201UseJavaApiForElasticSearch2/">2016-12-01</a></time>
      
      
  
    <h1 class="title"><a href="/2016/12/01/20161201UseJavaApiForElasticSearch2/">使用ElasticSearch的JavaAPI2(UseJavaApiForElasticSearch2)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="单独文档的APIs"><a href="#单独文档的APIs" class="headerlink" title="单独文档的APIs"></a>单独文档的APIs</h2><h3 id="Index-API"><a href="#Index-API" class="headerlink" title="Index API"></a>Index API</h3><h4 id="生成Json"><a href="#生成Json" class="headerlink" title="生成Json"></a>生成Json</h4><ul>
<li>手动</li>
<li>使用<code>Map</code></li>
<li>使用第三方库如Jackson</li>
<li>使用內建的jsonBuilder()</li>
</ul>
<h4 id="建立索引文档"><a href="#建立索引文档" class="headerlink" title="建立索引文档"></a>建立索引文档</h4><p>下面的例子是建立一个索引为twitter,类型为tweet,id为1的文档,<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import static org.elasticsearch.common.xcontent.XContentFactory.*;</span><br><span class="line"> </span><br><span class="line">IndexResponse response = client.prepareIndex("twitter", "tweet", "1")</span><br><span class="line">        .setSource(jsonBuilder()</span><br><span class="line">                    .startObject()</span><br><span class="line">                        .field("user", "kimchy")</span><br><span class="line">                        .field("postDate", new Date())</span><br><span class="line">                        .field("message", "trying out Elasticsearch")</span><br><span class="line">                    .endObject()</span><br><span class="line">                  )</span><br><span class="line">        .get();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>或者通过另一种建立json的方式<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String json = "{" +</span><br><span class="line">        "\"user\":\"kimchy\"," +</span><br><span class="line">        "\"postDate\":\"2013-01-30\"," +</span><br><span class="line">        "\"message\":\"trying out Elasticsearch\"" +</span><br><span class="line">    "}";</span><br><span class="line"> </span><br><span class="line">IndexResponse response = client.prepareIndex("twitter", "tweet")</span><br><span class="line">        .setSource(json)</span><br><span class="line">        .get();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>之后你可以通过调用上面的<code>response</code>来查看建立的结果<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// Index name</span><br><span class="line">String _index = response.getIndex();</span><br><span class="line">// Type name</span><br><span class="line">String _type = response.getType();</span><br><span class="line">// Document ID (generated or not)</span><br><span class="line">String _id = response.getId();</span><br><span class="line">// Version (if it's the first time you index this document, you will get: 1)</span><br><span class="line">long _version = response.getVersion();</span><br><span class="line">// isCreated() is true if the document is a new one, false if it has been updated</span><br><span class="line">boolean created = response.isCreated();</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="GetAPI"><a href="#GetAPI" class="headerlink" title="GetAPI"></a>GetAPI</h3><p>下面使用client调用 index是 twitter type是tweet id为1的文档<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetResponse response = client.prepareGet("twitter", "tweet", "1").get();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>更多的getapi则需要参考<a href="http://www.elastic.co/guide/en/elasticsearch/reference/5.0/docs-get.html" target="_blank" rel="noopener">get docs</a></p>
<p>其它的delete update multiget  bulkapi都需要查看es的相应rest调用文档</p>
<h3 id="BulkAPI"><a href="#BulkAPI" class="headerlink" title="BulkAPI"></a>BulkAPI</h3><p>bulk API 允许你通过一个请求来检索或者删除多个文档,增加吞吐量,下面是一个应用:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import static org.elasticsearch.common.xcontent.XContentFactory.*;</span><br><span class="line"> </span><br><span class="line">BulkRequestBuilder bulkRequest = client.prepareBulk();</span><br><span class="line"> </span><br><span class="line">// either use client#prepare, or use Requests# to directly build index/delete requests</span><br><span class="line">bulkRequest.add(client.prepareIndex("twitter", "tweet", "1")</span><br><span class="line">        .setSource(jsonBuilder()</span><br><span class="line">                    .startObject()</span><br><span class="line">                        .field("user", "kimchy")</span><br><span class="line">                        .field("postDate", new Date())</span><br><span class="line">                        .field("message", "trying out Elasticsearch")</span><br><span class="line">                    .endObject()</span><br><span class="line">                  )</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">bulkRequest.add(client.prepareIndex("twitter", "tweet", "2")</span><br><span class="line">        .setSource(jsonBuilder()</span><br><span class="line">                    .startObject()</span><br><span class="line">                        .field("user", "kimchy")</span><br><span class="line">                        .field("postDate", new Date())</span><br><span class="line">                        .field("message", "another post")</span><br><span class="line">                    .endObject()</span><br><span class="line">                  )</span><br><span class="line">        );</span><br><span class="line"> </span><br><span class="line">BulkResponse bulkResponse = bulkRequest.get();</span><br><span class="line">if (bulkResponse.hasFailures()) {</span><br><span class="line">    // process failures by iterating through each bulk response item</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="使用Using-Bulk-Processor"><a href="#使用Using-Bulk-Processor" class="headerlink" title="使用Using Bulk Processor"></a>使用Using Bulk Processor</h3><p><code>BulkProcessor</code>类提供了一个简单的接口可以通过请求的数量或者给定的时间来自动的进行flush操作.<br>使用这个类,首先要创建一个BulkProcessor实例:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import org.elasticsearch.action.bulk.BackoffPolicy;</span><br><span class="line">import org.elasticsearch.action.bulk.BulkProcessor;</span><br><span class="line">import org.elasticsearch.common.unit.ByteSizeUnit;</span><br><span class="line">import org.elasticsearch.common.unit.ByteSizeValue;</span><br><span class="line">import org.elasticsearch.common.unit.TimeValue;</span><br><span class="line"> </span><br><span class="line">BulkProcessor bulkProcessor = BulkProcessor.builder(</span><br><span class="line">        client, </span><br><span class="line">        new BulkProcessor.Listener() {</span><br><span class="line">            @Override</span><br><span class="line">            public void beforeBulk(long executionId,</span><br><span class="line">                                   BulkRequest request) { ... }</span><br><span class="line"> </span><br><span class="line">            @Override</span><br><span class="line">            public void afterBulk(long executionId,</span><br><span class="line">                                  BulkRequest request,</span><br><span class="line">                                  BulkResponse response) { ... }</span><br><span class="line"> </span><br><span class="line">            @Override</span><br><span class="line">            public void afterBulk(long executionId,</span><br><span class="line">                                  BulkRequest request,</span><br><span class="line">                                  Throwable failure) { ... }</span><br><span class="line">        })</span><br><span class="line">        .setBulkActions(10000)</span><br><span class="line">        .setBulkSize(new ByteSizeValue(5, ByteSizeUnit.MB))</span><br><span class="line">        .setFlushInterval(TimeValue.timeValueSeconds(5))</span><br><span class="line">        .setConcurrentRequests(1)</span><br><span class="line">        .setBackoffPolicy(</span><br><span class="line">            BackoffPolicy.exponentialBackoff(TimeValue.timeValueMillis(100), 3))</span><br><span class="line">        .build();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>其中的<code>setConcurrentRequests(1)</code>指同时允许多少个并发,0的话意味着不允许,1则表示允许一个并发请求.<br><code>setBackoffPolicy</code>则可以允许用户自定义当一个或者多个bulk请求失败后,该执行如何操作,而这个失败是要求基于<code>EsRejectedExecutionException</code>,也就是说集群内的计算资源不够导致的请求失败,如果不设定的话使用<code>BackoffPolicy.noBackoff()</code><br>当所有的需要执行的操作加载到bulk中之后,可使用两种方式来关闭这个bulk<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bulkProcessor.awaitClose(10, TimeUnit.MINUTES);</span><br><span class="line">or</span><br><span class="line">bulkProcessor.close();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>这两个操作都会flush所有的剩余bulk操作,前者会等待一段时间,如果在这段时间 flush成功,则返回<code>true</code> 否则返回<code>false</code>,<br>后者则会直接退出,不在等待所有的bulk执行操作完成</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/" target="_blank" rel="noopener">ElasticSearch Java API</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/12/01/20161201UseJavaApiForElasticSearch2/">https://blog.littleji.com/2016/12/01/20161201UseJavaApiForElasticSearch2/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-configuration"><span class="toc-number">1.</span> <span class="toc-text">配置(configuration)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Maven"><span class="toc-number">1.1.</span> <span class="toc-text">Maven</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97-Logger"><span class="toc-number">1.2.</span> <span class="toc-text">日志(Logger)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E4%BD%93%E6%89%93%E5%8C%85-Embedding-jar-with-dependencies"><span class="toc-number">1.3.</span> <span class="toc-text">整体打包(Embedding jar with dependencies)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AE%A2%E6%88%B7%E7%AB%AF-Client"><span class="toc-number">1.4.</span> <span class="toc-text">使用客户端(Client)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TransportClient"><span class="toc-number">1.5.</span> <span class="toc-text">TransportClient</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">2.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-11-30T06:27:20.000Z"><a href="/2016/11/30/20161130UseJavaApiForElasticSearch1/">2016-11-30</a></time>
      
      
  
    <h1 class="title"><a href="/2016/11/30/20161130UseJavaApiForElasticSearch1/">使用ElasticSearch的JavaAPI 1(UseJavaApiForElasticSearch 1)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="配置-configuration"><a href="#配置-configuration" class="headerlink" title="配置(configuration)"></a>配置(configuration)</h2><h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><p>要使用相应的API,必须引入所需要的jar包,这里使用的ElasticSearch5.0版本相应的Maven配置如下所示:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><dependency></span><br><span class="line">    <groupId>org.elasticsearch.client</groupId></span><br><span class="line">    <artifactId>transport</artifactId></span><br><span class="line">    <version>5.0.1</version></span><br><span class="line"></dependency></span><br><span class="line"><dependency></span><br><span class="line">    <groupId>org.apache.logging.log4j</groupId></span><br><span class="line">    <artifactId>log4j-api</artifactId></span><br><span class="line">    <version>2.6.2</version></span><br><span class="line"></dependency></span><br><span class="line"><dependency></span><br><span class="line">    <groupId>org.apache.logging.log4j</groupId></span><br><span class="line">    <artifactId>log4j-core</artifactId></span><br><span class="line">    <version>2.6.2</version></span><br><span class="line"></dependency></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="日志-Logger"><a href="#日志-Logger" class="headerlink" title="日志(Logger)"></a>日志(Logger)</h3><p>之后配置日志,这里使用的是log4j2,在<code>src/main/resources</code>下添加名为<code>log4f2.properties</code>的文件,并在其中添加如下的内容:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appender.console.type = Console</span><br><span class="line">appender.console.name = console</span><br><span class="line">appender.console.layout.type = PatternLayout</span><br><span class="line"> </span><br><span class="line">rootLogger.level = info</span><br><span class="line">rootLogger.appenderRef.console.ref = console</span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="整体打包-Embedding-jar-with-dependencies"><a href="#整体打包-Embedding-jar-with-dependencies" class="headerlink" title="整体打包(Embedding jar with dependencies)"></a>整体打包(Embedding jar with dependencies)</h3><p>将所使用的jar依赖包和你的应用同时打包为一个jar文件,此时不应该使用<code>maven-assembly-plugin</code>, 因为没有Lucene的jar包,导致该插件无法解析<code>META-INF/service</code>的结构,相应的你可以使用<code>maven-shade-plugin</code>插件,配置如下所示<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><plugin></span><br><span class="line">    <groupId>org.apache.maven.plugins</groupId></span><br><span class="line">    <artifactId>maven-shade-plugin</artifactId></span><br><span class="line">    <version>2.4.1</version></span><br><span class="line">    <executions></span><br><span class="line">        <execution></span><br><span class="line">            <phase>package</phase></span><br><span class="line">            <goals><goal>shade</goal></goals></span><br><span class="line">            <configuration></span><br><span class="line">                <transformers></span><br><span class="line">                    <transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/></span><br><span class="line">                </transformers></span><br><span class="line">            </configuration></span><br><span class="line">        </execution></span><br><span class="line">    </executions></span><br><span class="line"></plugin></span><br></pre></td></tr></tbody></table></figure><p></p>
<p>如果有main.class 可加入下面的配置:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer"></span><br><span class="line">    <mainClass>org.elasticsearch.demo.Generate</mainClass></span><br><span class="line"></transformer></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="使用客户端-Client"><a href="#使用客户端-Client" class="headerlink" title="使用客户端(Client)"></a>使用客户端(Client)</h3><p>客户端可以做以下几件事情:</p>
<ol>
<li>在已有的集群之上进行,索引,插入,删除,搜索等操作</li>
<li>在已有的集群上运行管理员的任务</li>
</ol>
<ul>
<li>注意: 客户端的主版本号必须同集群节点的版本号相一致<br>一般通过<code>TransportClient</code> 来连接ES集群</li>
</ul>
<h3 id="TransportClient"><a href="#TransportClient" class="headerlink" title="TransportClient"></a>TransportClient</h3><p>当你使用TansportClient来连接一个ES集群的时候,你并不参与到这个集群中,而是获得这个集群的一个或多个地址,并在实际执行操作的时候,依次的操作它们,尽管大多数的操作都可能是两段式的(It does not join the cluster, but simply gets one or more initial transport addresses and communicates with them in round robin fashion on each action(though most actions will probably be “two hop” operations).)<br>下面是如何开始和结束一个TransportClient<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// on startup</span><br><span class="line"> </span><br><span class="line">TransportClient client = new PreBuiltTransportClient(Settings.EMPTY)</span><br><span class="line">        .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName("host1"), 9300))</span><br><span class="line">        .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName("host2"), 9300));</span><br><span class="line"> </span><br><span class="line">// on shutdown</span><br><span class="line"> </span><br><span class="line">client.close();</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>其中得Setting,按照下面所示进行设置<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Settings settings = Settings.builder()</span><br><span class="line">        .put("cluster.name", "myClusterName").build();</span><br><span class="line">TransportClient client = new PreBuiltTransportClient(settings);</span><br><span class="line">//Add transport addresses and do something with the client...</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>TransportClient 自身有一个集群发现的功能,其能够动态的添加host和移除之前已有的.<br>一旦发现功能启用,transport client就将根据其配置的节点列表进行连接,而节点列表的配置则是通过<code>addTransportAddress</code>来配置的.之后,客户端将调用集群内部的状态API,来发现可用的数据节点.内部客户端的节点列表将替换为只有数据节点,并且这份列表默认每过5秒,刷新一次<br>如果需要开启发现功能,设置<code>client.trasport.sniff</code>为true</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/" target="_blank" rel="noopener">ElasticSearch Java API</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/11/30/20161130UseJavaApiForElasticSearch1/">https://blog.littleji.com/2016/11/30/20161130UseJavaApiForElasticSearch1/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B31"><span class="toc-number">1.1.</span> <span class="toc-text">解决1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B32"><span class="toc-number">1.2.</span> <span class="toc-text">解决2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B33"><span class="toc-number">1.3.</span> <span class="toc-text">解决3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">3.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-11-28T11:50:20.000Z"><a href="/2016/11/28/20161128Don'tForgetTheResultMapWhenYouUseMybatis/">2016-11-28</a></time>
      
      
  
    <h1 class="title"><a href="/2016/11/28/20161128Don'tForgetTheResultMapWhenYouUseMybatis/">别忘了使用Mybatis  ResultMap(Don&#39;t forget the ResultMap when you use Mybatis)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>最近需要使用Mybatis来操作MySQL,由于入门就随意的拿来一篇入门介绍和官方的教程,照着走一遍,奈何写好了Mapper,Bean,以及配置好数据库,以及对应的xml后会发现无论如何也无法得到实例化后的Bean.事实上,并没有一些bug信息,也没有抛异常.</p>
<h3 id="解决1"><a href="#解决1" class="headerlink" title="解决1"></a>解决1</h3><p>判断是否是数据库本身的连接的问题.<br>尝试更改mybatis的数据库mysql配置 => 数据库连接没问题</p>
<h3 id="解决2"><a href="#解决2" class="headerlink" title="解决2"></a>解决2</h3><p>判断是否是数据库得命令没有正常执行<br>查找mysql的general日志,发现没有,于是查看general的设置使用下面的命令<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like '%gener%';</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>返回下面的信息<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+------------------+-------------------------------------------------+</span><br><span class="line">| Variable_name    | Value                                           |</span><br><span class="line">+------------------+-------------------------------------------------+</span><br><span class="line">| general_log      | OFF                                              |</span><br><span class="line">| general_log_file | /tmp/mysql/general.log |</span><br><span class="line">+------------------+-------------------------------------------------+</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>打开general_log<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log=on;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>如果需要自定义日志的路径,同理设置不再赘述.<br>使用<code>tail -F /tmp/mysql/general.log</code> 监控mysql的查询信息<br>运行自己得mybatis 测试用例,可以看到上面的命令打印到了控制台,结果如下:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">161129 18:01:33       15 Connect    root@192.168.1.188 on test</span><br><span class="line">           15 Query    /* mysql-connector-java-5.1.38 ( Revision: fe541c166cec739c74cc727c5da96c1028b4834a ) */SELECT  @@session.auto_increment_increment AS auto_increment_increment, @@character_set_client AS character_set_client, @@character_set_connection AS character_set_connection, @@character_set_results AS character_set_results, @@character_set_server AS character_set_server, @@init_connect AS init_connect, @@interactive_timeout AS interactive_timeout, @@license AS license, @@lower_case_table_names AS lower_case_table_names, @@max_allowed_packet AS max_allowed_packet, @@net_buffer_length AS net_buffer_length, @@net_write_timeout AS net_write_timeout, @@query_cache_size AS query_cache_size, @@query_cache_type AS query_cache_type, @@sql_mode AS sql_mode, @@system_time_zone AS system_time_zone, @@time_zone AS time_zone, @@tx_isolation AS tx_isolation, @@wait_timeout AS wait_timeout</span><br><span class="line">           15 Query    SELECT @@session.autocommit</span><br><span class="line">           15 Query    SET character_set_results = NULL</span><br><span class="line">           15 Query    SET autocommit=1</span><br><span class="line">           15 Query    SET autocommit=0</span><br><span class="line">           15 Query    SELECT * FROM t_cloud_uba_vm_action WHERE C_ID = 1</span><br><span class="line">           15 Query    SET autocommit=1</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>说明数据库的命令执行也没问题</p>
<h3 id="解决3"><a href="#解决3" class="headerlink" title="解决3"></a>解决3</h3><p>回想起,自身项目与参考的项目唯一的不同就是Bean不同,MySQL表不同<br>将Bean中的属性名称完全与MySQL一一对应,运行后解决</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>查看mybatis的Result_Maps文档,发现定义了一个Java Bean后,select语句会精确的匹配JavaBean中的属性,然后映射到结果集.这个就是关键所在,当然可以不完全的对应起来,不过需要 ResultMap来,使用select语句的别名,最终匹配到对应的属性上,如下所示<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><select id="selectUsers" resultType="User"></span><br><span class="line">  select</span><br><span class="line">    user_id             as "id",</span><br><span class="line">    user_name           as "userName",</span><br><span class="line">    hashed_password     as "hashedPassword"</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #{id}</span><br><span class="line"></select></span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.mybatis.org/mybatis-3/zh/sqlmap-xml.html#Result_Maps" target="_blank" rel="noopener">http://www.mybatis.org/mybatis-3/zh/sqlmap-xml.html#Result_Maps</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/11/28/20161128Don'tForgetTheResultMapWhenYouUseMybatis/">https://blog.littleji.com/2016/11/28/20161128Don'tForgetTheResultMapWhenYouUseMybatis/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-abstract"><span class="toc-number">1.</span> <span class="toc-text">概述(abstract)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%981-trouble-No-1"><span class="toc-number">2.</span> <span class="toc-text">问题1(trouble No.1)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A1"><span class="toc-number">2.0.1.</span> <span class="toc-text">解释1</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%982-trouble-No-2"><span class="toc-number">3.</span> <span class="toc-text">问题2(trouble No.2)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A2"><span class="toc-number">3.0.1.</span> <span class="toc-text">解释2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">完整的配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.</span> <span class="toc-text">参考</span></a></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-11-28T01:50:20.000Z"><a href="/2016/11/28/20161128UseMultilinePluginToDecodeAWholeJsonFile/">2016-11-28</a></time>
      
      
  
    <h1 class="title"><a href="/2016/11/28/20161128UseMultilinePluginToDecodeAWholeJsonFile/">使用LogStash中的multiline插件来进行json文件解析(use the multiline plugin to decode a whole json file)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述-abstract"><a href="#概述-abstract" class="headerlink" title="概述(abstract)"></a>概述(abstract)</h2><p>如果希望得到配置文件请直接查看”配置(configuration)” if you just want to get the configure file of logstash,so just look at “Configuration”.<br>最近需要通过logstah处理json格式的日志,最好的结果是配置配置Logstash中的config,用用其他轮子插件,自动化的解析.例如这样一段待分析的信息:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    "tenantslst": [</span><br><span class="line">        {</span><br><span class="line">            "total_memory_mb_usage": "3.2711112E-5",</span><br><span class="line">            "total_vcpus_usage": "6.3888889E-8",</span><br><span class="line">            "start": "2016-08-26T08:56:34.596973",</span><br><span class="line">            "tenant_id": "70be30112729411dr92acda6ae5ae0215",</span><br><span class="line">            "stop": "2016-08-26T08:56:34.596996",</span><br><span class="line">            "total_hours": "6.388889E-8",</span><br><span class="line">            "total_local_gb_usage": "6.388889E-8"</span><br><span class="line">        }</span><br><span class="line">    ],</span><br><span class="line">    "quotalst": [ ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>最终解析得结果如下:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">"body" => {</span><br><span class="line">       "tenantslst" => [</span><br><span class="line">           [0] {</span><br><span class="line">               "total_memory_mb_usage" => "3.2711112E-5",</span><br><span class="line">                   "total_vcpus_usage" => "6.3888889E-8",</span><br><span class="line">                               "start" => "2016-08-26T08:56:34.596973",</span><br><span class="line">                           "tenant_id" => "70be30112729411dr92acda6ae5ae0215",</span><br><span class="line">                                "stop" => "2016-08-26T08:56:34.596996",</span><br><span class="line">                         "total_hours" => "6.388889E-8",</span><br><span class="line">                "total_local_gb_usage" => "6.388889E-8"</span><br><span class="line">           }</span><br><span class="line">       ],</span><br><span class="line">         "quotalst" => []</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="问题1-trouble-No-1"><a href="#问题1-trouble-No-1" class="headerlink" title="问题1(trouble No.1)"></a>问题1(trouble No.1)</h2><p>在处理日志的时候会遇到这样的问题:logstash 默认会将所监视文件的每一行进行拆分,并单独的作为一个文事件于是就有一个完整的json file 被拆成了数个事件,这违背初衷,所以首先解决其自动拆分的问题.<br>multiline的插件就是为此而生,下面贴出multiline的简单的配置:<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> multiline{</span><br><span class="line">        pattern => "^haha"</span><br><span class="line">        #negate => true</span><br><span class="line">        what => "previous"</span><br><span class="line">        max_age =>  5</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="解释1"><a href="#解释1" class="headerlink" title="解释1"></a>解释1</h4><p>pattern:表示组成多行的json中, 每一行都具有什么样的特征,这个特征通过正则表达式进行匹配,如果匹配成功则认定此为多行块中的一行<br>what:有两个值 “previous”和”next”, 如果是previous,则将该行归到上面一个多行块中,如果是next,则归到下面一个代码块中<br>max_age:如果没有再有新行添加到多行中,那么在max_age后,这个多行块将被推送,默认是5,单位是秒</p>
<h2 id="问题2-trouble-No-2"><a href="#问题2-trouble-No-2" class="headerlink" title="问题2(trouble No.2)"></a>问题2(trouble No.2)</h2><p>现在我们通过multiline插件获得了一个多行json块,剩下的就是将这个json串解析.<br>这个比较简单,logstash 中的filter有 json 这个插件,配置上就可以搞定,前提是之前的json必须是一个合规的json串<br>下面贴出其配置项<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">json{</span><br><span class="line">    source => "message"</span><br><span class="line">    target => "body"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h4 id="解释2"><a href="#解释2" class="headerlink" title="解释2"></a>解释2</h4><p>source 就是存储json串的字段,默认是message字段<br>最好是将该字段分析后删除,可以使用mutate这个插件,并开启remove_field这个选项,否则不仅分析后的数据进入到了es,原json串也进入,导致存储的数据,占用双倍的空间.<br>并且该选项也是支持正则表达式的.<br></p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filter {</span><br><span class="line">  mutate {</span><br><span class="line">    remove_field => [ "foo_%{somefield}" ]</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="完整的配置"><a href="#完整的配置" class="headerlink" title="完整的配置"></a>完整的配置</h2><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">input {</span><br><span class="line">    file {</span><br><span class="line">        path => "/path/to/log"</span><br><span class="line">        type => "some_type"</span><br><span class="line">        start_position => beginning</span><br><span class="line">        sincedb_path => "/dev/null"</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">filter {</span><br><span class="line">         multiline{</span><br><span class="line">                pattern => "^\{|\s|\}"</span><br><span class="line">                #negate => true</span><br><span class="line">                what => "previous"</span><br><span class="line">                max_age =>  5</span><br><span class="line">        }</span><br><span class="line">    json{</span><br><span class="line">        source => "message"</span><br><span class="line">        target => "body"</span><br><span class="line">    }</span><br><span class="line">  mutate {</span><br><span class="line">    remove_field => [ "foo_%{somefield}" ]</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-multiline.html#plugins-filters-multiline" target="_blank" rel="noopener">Multiline Plugin</a></p>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/11/28/20161128UseMultilinePluginToDecodeAWholeJsonFile/">https://blog.littleji.com/2016/11/28/20161128UseMultilinePluginToDecodeAWholeJsonFile/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-abstract"><span class="toc-number">1.</span> <span class="toc-text">概述(abstract)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E9%85%8D%E7%BD%AE-configuration"><span class="toc-number">2.</span> <span class="toc-text">具体配置(configuration)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0-remove-and-update-git"><span class="toc-number">2.1.</span> <span class="toc-text">卸载和安装最新(remove and update git)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%BE%83%E5%BF%AB%E7%9A%84hosts-use-faster-host-for-github-com"><span class="toc-number">2.2.</span> <span class="toc-text">使用较快的hosts(use faster host for github.com)</span></a></li></ol></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-11-15T05:50:00.000Z"><a href="/2016/11/15/20161115AlmostPerfectGitConfiguration/">2016-11-15</a></time>
      
      
  
    <h1 class="title"><a href="/2016/11/15/20161115AlmostPerfectGitConfiguration/">git较为完整安装与配置,解决git clone速度慢等问题(Almost perfect git configuration)</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述-abstract"><a href="#概述-abstract" class="headerlink" title="概述(abstract)"></a>概述(abstract)</h2><p>  Github最近又开始不稳定,而在bower等安装的过程中会利用到其上面的源, 在包的下载总会因为网络或者的问题,导致中断安装,而每次重新安装的时间较长.<br>为了让大家不再因为此浪费时间,给大家一些可能有用的配置建议.</p>
<h2 id="具体配置-configuration"><a href="#具体配置-configuration" class="headerlink" title="具体配置(configuration)"></a>具体配置(configuration)</h2><h3 id="卸载和安装最新-remove-and-update-git"><a href="#卸载和安装最新-remove-and-update-git" class="headerlink" title="卸载和安装最新(remove and update git)"></a>卸载和安装最新(remove and update git)</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mkdir /root/APP</span><br><span class="line">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel -y</span><br><span class="line">yum install  gcc perl-ExtUtils-MakeMaker -y</span><br><span class="line">yum remove git -y</span><br><span class="line">cd /home/zeppelin/prerequisites</span><br><span class="line">wget https://www.kernel.org/pub/software/scm/git/git-2.10.2.tar.gz#you can look for the lastest version of git and replace 2.10.2</span><br><span class="line">tar xzf git-2.10.2.tar.gz</span><br><span class="line">cd git-2.10.2</span><br><span class="line">make prefix=/root/APP/git all</span><br><span class="line">make prefix=/root/APP/git install</span><br><span class="line">echo "export PATH=$PATH:/root/APP/git/bin" >> /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line">git config --global url."https://".insteadOf git://</span><br><span class="line">git --version</span><br></pre></td></tr></tbody></table></figure>
<h3 id="使用较快的hosts-use-faster-host-for-github-com"><a href="#使用较快的hosts-use-faster-host-for-github-com" class="headerlink" title="使用较快的hosts(use faster host for github.com)"></a>使用较快的hosts(use faster host for github.com)</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#add the below hosts into your /etc/hosts</span><br><span class="line">192.30.253.118 gist.github.com</span><br><span class="line">192.30.253.119 gist.github.com</span><br></pre></td></tr></tbody></table></figure>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/11/15/20161115AlmostPerfectGitConfiguration/">https://blog.littleji.com/2016/11/15/20161115AlmostPerfectGitConfiguration/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%BB%E6%8E%A5%E7%9F%A9%E9%98%B5"><span class="toc-number">1.</span> <span class="toc-text">邻接矩阵</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%B4%A8"><span class="toc-number">1.2.</span> <span class="toc-text">性质</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A0%E5%90%91%E5%9B%BE%E7%9A%84%E9%82%BB%E6%8E%A5%E7%9F%A9%E9%98%B5%E5%AF%B9%E7%A7%B0%E7%9F%A9%E9%98%B5"><span class="toc-number">1.2.1.</span> <span class="toc-text">无向图的邻接矩阵对称矩阵</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%82%BB%E6%8E%A5%E7%9F%A9%E9%98%B5%E7%9A%84%E5%A4%A7%E5%B0%8F-%E9%A1%B6%E7%82%B9%E6%95%B0-%E9%A1%B6%E7%82%B9%E6%95%B0"><span class="toc-number">1.2.2.</span> <span class="toc-text">邻接矩阵的大小&#x3D;顶点数*顶点数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.3.</span> <span class="toc-text">数据压缩的属性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%BB%E6%8E%A5%E9%93%BE%E8%A1%A8"><span class="toc-number">2.</span> <span class="toc-text">邻接链表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">2.1.1.</span> <span class="toc-text">参考:</span></a></li></ol></li></ol></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-05-12T05:38:20.000Z"><a href="/2016/05/12/20160512AdjacencyListAndAdjacencyMatrix/">2016-05-12</a></time>
      
      
  
    <h1 class="title"><a href="/2016/05/12/20160512AdjacencyListAndAdjacencyMatrix/">邻接矩阵,邻接列表一些基本概念和应用(Adjacency list and Adjacency matrix)</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="邻接矩阵"><a href="#邻接矩阵" class="headerlink" title="邻接矩阵"></a>邻接矩阵</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><p> 邻接矩阵,其只要是用来存储一个图结构.</p>
<p> 首先一个无向图如下所示</p>
<div align="center">
<img class="little" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/28/6n-graph2.svg/185px-6n-graph2.svg.png">
</div>
<div align="center">
<img class="little" src="https://upload.wikimedia.org/math/c/a/e/caec49086f2faf102df7972d0dcde54b.png">
</div>

<h4 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h4><h5 id="无向图的邻接矩阵对称矩阵"><a href="#无向图的邻接矩阵对称矩阵" class="headerlink" title="无向图的邻接矩阵对称矩阵"></a>无向图的邻接矩阵对称矩阵</h5><p>由上图发现该图其实是个对称矩阵,这是由无向图的性质决定的,无向图的各个顶点之间的连线是具有相互性的,于是每有一个顶点之间的连线就要延伸出一组关系,表现在邻接矩阵上就是对称点的值相同(a12 = a21 依次类推)</p>
<h5 id="邻接矩阵的大小-顶点数-顶点数"><a href="#邻接矩阵的大小-顶点数-顶点数" class="headerlink" title="邻接矩阵的大小=顶点数*顶点数"></a>邻接矩阵的大小=顶点数*顶点数</h5><p>很容易了解,一个图的顶点数决定了其对应邻接矩阵的大小,例如上图是个6个顶点的图,则对应的矩阵需要6*6的大小方可表达其结构</p>
<h5 id="数据压缩的属性"><a href="#数据压缩的属性" class="headerlink" title="数据压缩的属性"></a>数据压缩的属性</h5><ul>
<li>由于事实上每一组顶点关系只需要一位来来表达,处理一个有4个顶点的图仅仅需要 4<em>4/8个=2个字节,这是很节省空间的,如果是一个无向图的话,所需要的空间则可以再减少一半的空间 4</em>4/16个=1个字节,通过这个方法已经接近信息论中表达一个n个顶点所需要字节数的下界.</li>
<li>但是也存在一些问题,例如其可能需要存储那些本来不存在的边</li>
</ul>
<h3 id="邻接链表"><a href="#邻接链表" class="headerlink" title="邻接链表"></a>邻接链表</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><p>邻接链表也是一种表达图的方式<br>假设有无向图如下所示<br> </p><div align="center">
<img class="little" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Simple_cycle_graph.svg/120px-Simple_cycle_graph.svg.png" align="center">
 </div><p></p>
<p>则相对应的表示为三个list{b,c},{a,c},{a,b}<br>但是换出去空间的节省后,查询时间也会相应的边长<br>例如:查询a与b是否有关系需要首先定位到a的链表{b,c},再对这个链表进行遍历,如果没有b,也就说明对其进行了完整的遍历,浪费了较多的时间,当然可以采用快速搜索的方式进行优化</p>
<ul>
<li>事实上邻接列表还有一点是其应用在大型稀疏矩阵中,因为邻接矩阵不需要浪费空间来表达那些不存在的边缘</li>
</ul>
<h5 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h5><ul>
<li><a href="https://en.wikipedia.org/wiki/Adjacency_matrix" target="_blank" rel="noopener">Adjacency_matrix</a></li>
<li><a href="https://en.wikipedia.org/wiki/Adjacency_list" target="_blank" rel="noopener">Adjacency_list</a></li>
</ul>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/05/12/20160512AdjacencyListAndAdjacencyMatrix/">https://blog.littleji.com/2016/05/12/20160512AdjacencyListAndAdjacencyMatrix/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D%E8%B7%B3%E8%BD%AC%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84GitPage%E9%A1%B5"><span class="toc-number">2.1.</span> <span class="toc-text">自定义域名跳转到对应的GitPage页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%8F%91%E7%8E%B0css-js%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E8%BE%83%E6%85%A2"><span class="toc-number">2.2.</span> <span class="toc-text">当发现css js等静态文件加载较慢</span></a></li></ol></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-05-10T01:50:20.000Z"><a href="/2016/05/10/20160510SomethingAboutSiteManagement/">2016-05-10</a></time>
      
      
  
    <h1 class="title"><a href="/2016/05/10/20160510SomethingAboutSiteManagement/">建站中的一些问题</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul>
<li>主要是为了更好的记录建站中遇到的问题,一方面备忘,一方面来为后来者提供方便</li>
</ul>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="自定义域名跳转到对应的GitPage页"><a href="#自定义域名跳转到对应的GitPage页" class="headerlink" title="自定义域名跳转到对应的GitPage页"></a>自定义域名跳转到对应的GitPage页</h3><ul>
<li>首先需要在对应的域名解析服务器上添加两条记录如下所示</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>记录类型</th>
<th>主机记录</th>
<th>记录值 </th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>@</td>
<td>192.30.xxx.xxx</td>
</tr>
<tr>
<td>A</td>
<td>@</td>
<td>192.30.xxx.xxx</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>在对应的XXX.github.io repository下加入一个以CNAME命名的文件,并在其中写入你的自定义域名如<code>baidu.com</code> 切记不要加<code>www</code>,之后等待生效即可</li>
</ul>
<h3 id="当发现css-js等静态文件加载较慢"><a href="#当发现css-js等静态文件加载较慢" class="headerlink" title="当发现css js等静态文件加载较慢"></a>当发现css js等静态文件加载较慢</h3><ul>
<li>这种时候可以使用 七牛等云加速产品来保证网页的加载速度,七牛每个月有一些免费流量,只是有的时候还不如github上的文件加载速度快</li>
<li>更改前端库cdn 为国内的cdn</li>
<li>更改google的字体库位 useso</li>
<li>几个推荐的前端库<ul>
<li><a href="http://www.bootcdn.cn/?" target="_blank" rel="noopener">BootCDN</a> 这一个好像就够用了</li>
</ul>
</li>
</ul>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/05/10/20160510SomethingAboutSiteManagement/">https://blog.littleji.com/2016/05/10/20160510SomethingAboutSiteManagement/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
    
    <div id="toc" class="toc-article">
      <strong class="toc-title">目录</strong>
      <a class="js-toggle-toc" href="javascript:void(0)"></a>
      <div class="toc-content">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9B%A0"><span class="toc-number">2.</span> <span class="toc-text">原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update"><span class="toc-number">4.</span> <span class="toc-text">update</span></a></li></ol>
      </div>
    </div>
  
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-04-23T10:34:12.000Z"><a href="/2016/04/23/20160423Return/">2016-04-23</a></time>
      
      
  
    <h1 class="title"><a href="/2016/04/23/20160423Return/">重来</a></h1>
  

    </header>
    <div class="entry">
      
        <blockquote>
<p>I guess it comes down to a simple choice:get busy living or get busy dying.<br> The Shawshank Redemption </p>
</blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>此文简单的概述重新建立博客的理由,以及过程</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><ul>
<li>重新建立博客 原因有这么几条:<ol>
<li>希望跟更多的人交流和分享一些心得</li>
<li>实习有了一些收入</li>
<li>科学上网的需求</li>
</ol>
</li>
</ul>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><ul>
<li>首先,上一次写博客大概是去年8月份的时候,由于用的是Amazon ec2,国内的浏览效果不好,SSH速度也很慢丢包严重,每次远程连接调一些配置都是挺煎熬一件事,于是就不再想去管它 ,并且,自己将平常的所看所想的一些东西写在为知笔记里面,也基本可以满足知识积累要求.</li>
<li>其次,赶上写论文,实习等等事情,实在是没有精力再去维护博客服务器.</li>
<li>最后,如同肖申克救赎里面的台词,  I guess it comes down to a simple choice:get busy living or get busy dying,不再给自身找借口,拿出一天来重新建立博客.</li>
</ul>
<h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><ul>
<li>好吧 最终还是用了<a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>来完成博客的编写,源于最近的香港服务器线路改道,也就不再更换服务器了.</li>
<li>好吧 再次换到了hexo, 只是因为我的新机子不想装go了,而且正好机子里面有node,并且hugo国内貌似不太行,换着来呗</li>
</ul>
<hr>
<p>版权声明:本文由littleji.com创作并发表,转载请注明作者及出处,欢迎关注公众号:littleji_com<br><a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">本文遵守CC BY0SA 4.0</a><br>if you have any questions, please leave a message behind or give an <a href="https://github.com/littleji/littleji.github.io/issues" target="_blank" rel="noopener">issue</a></p>
<p>本文链接为：<a href="https://blog.littleji.com/2016/04/23/20160423Return/">https://blog.littleji.com/2016/04/23/20160423Return/</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">上一页</a>
  
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//baidu.com" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:blog.littleji.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/2019-04/">2019-04</a><small>1</small></li>
  
    <li><a href="/categories/2019-03/">2019-03</a><small>3</small></li>
  
    <li><a href="/categories/2019-02/">2019-02</a><small>2</small></li>
  
    <li><a href="/categories/2018-12/">2018-12</a><small>3</small></li>
  
    <li><a href="/categories/2018-11/">2018-11</a><small>1</small></li>
  
    <li><a href="/categories/2018-10/">2018-10</a><small>3</small></li>
  
    <li><a href="/categories/2018-09/">2018-09</a><small>2</small></li>
  
    <li><a href="/categories/2018-02/">2018-02</a><small>1</small></li>
  
    <li><a href="/categories/2018-01/">2018-01</a><small>2</small></li>
  
    <li><a href="/categories/2017-05/">2017-05</a><small>1</small></li>
  
    <li><a href="/categories/2016-12/">2016-12</a><small>4</small></li>
  
    <li><a href="/categories/2016-11/">2016-11</a><small>4</small></li>
  
    <li><a href="/categories/2016-05/">2016-05</a><small>2</small></li>
  
    <li><a href="/categories/2016-04/">2016-04</a><small>1</small></li>
  
  </ul>
</div>



  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Algorithm/">Algorithm</a><small>1</small></li>
  
    <li><a href="/tags/BookList/">BookList</a><small>1</small></li>
  
    <li><a href="/tags/DataMining/">DataMining</a><small>1</small></li>
  
    <li><a href="/tags/DataStructure/">DataStructure</a><small>1</small></li>
  
    <li><a href="/tags/DistributedComputation/">DistributedComputation</a><small>3</small></li>
  
    <li><a href="/tags/ELK/">ELK</a><small>3</small></li>
  
    <li><a href="/tags/ElasticSearch/">ElasticSearch</a><small>2</small></li>
  
    <li><a href="/tags/Error/">Error</a><small>1</small></li>
  
    <li><a href="/tags/Git/">Git</a><small>1</small></li>
  
    <li><a href="/tags/Golang/">Golang</a><small>1</small></li>
  
    <li><a href="/tags/Graph/">Graph</a><small>1</small></li>
  
    <li><a href="/tags/Java/">Java</a><small>2</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>2</small></li>
  
    <li><a href="/tags/Logstash/">Logstash</a><small>2</small></li>
  
    <li><a href="/tags/MachineLearning/">MachineLearning</a><small>5</small></li>
  
    <li><a href="/tags/MySQL/">MySQL</a><small>1</small></li>
  
    <li><a href="/tags/Mybatis/">Mybatis</a><small>1</small></li>
  
    <li><a href="/tags/NLP/">NLP</a><small>6</small></li>
  
    <li><a href="/tags/Navicat/">Navicat</a><small>1</small></li>
  
    <li><a href="/tags/ORM/">ORM</a><small>1</small></li>
  
    <li><a href="/tags/Programmer/">Programmer</a><small>1</small></li>
  
    <li><a href="/tags/Programming/">Programming</a><small>5</small></li>
  
    <li><a href="/tags/Rpc/">Rpc</a><small>2</small></li>
  
    <li><a href="/tags/Security/">Security</a><small>1</small></li>
  
    <li><a href="/tags/SiteManagement/">SiteManagement</a><small>1</small></li>
  
    <li><a href="/tags/SoftwareEngineering/">SoftwareEngineering</a><small>3</small></li>
  
    <li><a href="/tags/Translate/">Translate</a><small>2</small></li>
  
    <li><a href="/tags/jsonrpc4j/">jsonrpc4j</a><small>2</small></li>
  
    <li><a href="/tags/life/">life</a><small>1</small></li>
  
    <li><a href="/tags/信息安全/">信息安全</a><small>1</small></li>
  
    <li><a href="/tags/区块链/">区块链</a><small>1</small></li>
  
    <li><a href="/tags/图/">图</a><small>1</small></li>
  
    <li><a href="/tags/思考/">思考</a><small>1</small></li>
  
    <li><a href="/tags/数据挖掘/">数据挖掘</a><small>1</small></li>
  
    <li><a href="/tags/数据结构/">数据结构</a><small>1</small></li>
  
    <li><a href="/tags/框架/">框架</a><small>1</small></li>
  
    <li><a href="/tags/算法/">算法</a><small>1</small></li>
  
    <li><a href="/tags/自然语言处理/">自然语言处理</a><small>1</small></li>
  
    <li><a href="/tags/计算机语言/">计算机语言</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2019/04/27/20190427SomethingBeforeTheNlpPipline/">实施NLP流水线之前干点什么</a>
      </li>
    
      <li>
        <a href="/2019/03/15/20190318HeadFirstForGitLab/">Gitlab 入门与 工作流</a>
      </li>
    
      <li>
        <a href="/2019/03/05/20190305DataWhaleNLPTask2/">常见的分词方法与文本向量化</a>
      </li>
    
      <li>
        <a href="/2019/03/03/20190303DataWhaleNLPTask1/">windows下TensorFlow安装与imdb文本分类</a>
      </li>
    
      <li>
        <a href="/2019/02/19/20190219HandoverMemoList/">软件项目交接清单</a>
      </li>
    
  </ul>
</div>


  
<div class="widget links">
  <h3 class="title">友链</h3>
  <ul class="entry">
    
      <li><a target="_blank" rel="noopener" href="http://www.xiaobaidonghui.cn">小白</a></li>
    
  </ul>
</div>


</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2021 littleji
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'littleji';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
